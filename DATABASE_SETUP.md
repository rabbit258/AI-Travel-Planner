# 数据库设置指南

## 步骤 1: 在 Supabase 中创建数据库表

1. 登录你的 Supabase 项目
2. 进入 **SQL Editor**
3. 复制 `supabase-schema.sql` 文件中的全部内容
4. 在 SQL Editor 中粘贴并执行

这将创建以下表：
- `user_profiles` - 用户资料表
- `travel_plans` - 旅行计划表
- `expenses` - 费用记录表

同时会设置：
- Row Level Security (RLS) 策略，确保用户只能访问自己的数据
- 自动触发器，在用户注册时创建用户资料
- 自动更新时间戳的触发器

## 步骤 2: 验证设置

执行 SQL 后，你应该能在 Supabase Dashboard 的 **Table Editor** 中看到这三个表。

## 步骤 3: 测试认证

1. 启动应用：`npm run dev`
2. 点击右上角的"登录"按钮
3. 注册一个新账户（邮箱 + 密码，至少 6 个字符）
4. 登录后，你应该能看到"我的旅行计划"面板

## 功能说明

### 用户认证
- 注册：使用邮箱和密码（至少 6 个字符）
- 登录：使用注册的邮箱和密码
- 登出：点击右上角的"登出"按钮

### 计划管理
- **保存计划**：生成行程后，点击"保存当前计划"按钮
- **加载计划**：在"我的旅行计划"列表中点击任意计划即可加载
- **删除计划**：将鼠标悬停在计划上，点击右侧的删除图标

### 云端同步
- 计划数据（行程、偏好、预算等）会自动保存到云端
- 费用记录会在你修改后 1 秒内自动同步到云端
- 所有数据都会自动关联到当前登录的用户

## 故障排除

### 如果遇到 "relation does not exist" 错误
- 确保已执行 `supabase-schema.sql` 中的所有 SQL 语句
- 检查 Supabase 项目是否正确配置

### 如果无法保存计划
- 确保已登录
- 检查浏览器控制台是否有错误信息
- 确认 Supabase RLS 策略已正确设置

### 如果费用无法同步
- 确保已登录且已保存计划（有 plan_id）
- 检查网络连接
- 查看浏览器控制台的错误信息

